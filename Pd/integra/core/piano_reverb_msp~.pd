#N canvas 156 53 714 589 12;
#N canvas 446 78 537 696 tables 0;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-last-real 2048 float 0;
#X coords 0 500 2047 -500 200 150 1;
#X restore 47 30 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-last-imag 2048 float 0;
#X coords 0 500 2047 -500 200 150 1;
#X restore 269 30 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-amp-real 2048 float 0;
#X coords 0 500 2047 -500 200 150 1;
#X restore 47 202 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-amp-imag 2048 float 0;
#X coords 0 500 2047 -500 200 150 1;
#X restore 269 202 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-inc-real 2048 float 0;
#X coords 0 1 2047 -1 200 150 1;
#X restore 47 374 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-inc-imag 2048 float 0;
#X coords 0 1 2047 -1 200 150 1;
#X restore 269 374 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-hann 4096 float 0;
#X coords 0 1 4095 0 300 100 1;
#X restore 104 559 graph;
#X restore 415 203 pd tables;
#X text 88 261 reverb in;
#X text 85 309 reverb out;
#X obj 81 50 inlet~;
#X obj 399 54 inlet;
#X obj 190 48 inlet;
#X text 184 30 init-bang;
#X obj 79 371 outlet~;
#X obj 354 374 outlet;
#N canvas 92 24 1278 774 fft-analysis-resynthesis 0;
#X obj 560 533 *~;
#X obj 583 452 *~;
#X obj 496 449 *~;
#X obj 93 63 *~;
#X obj 18 569 outlet~;
#X obj 18 505 *~;
#X obj 32 29 inlet~;
#X obj 93 84 rfft~;
#X obj 18 451 rifft~;
#X obj 518 478 rsqrt~;
#X obj 484 533 *~;
#X obj 39 480 tabreceive~ \$0-hann;
#X obj 114 39 tabreceive~ \$0-hann;
#X obj 604 331 tabreceive~ \$0-inc-real;
#X obj 648 388 tabreceive~ \$0-inc-imag;
#X obj 681 248 tabsend~ \$0-last-imag;
#X obj 614 273 tabsend~ \$0-last-real;
#X obj 559 576 tabsend~ \$0-inc-imag;
#X obj 484 599 tabsend~ \$0-inc-real;
#X msg 908 154 set \$1 4;
#X obj 908 176 block~;
#X text 24 229 choose whether to;
#X text 22 247 punch in new (amplitude \,;
#X text 20 266 increment) pair;
#X obj 367 26 tabreceive~ \$0-amp-real;
#X obj 443 50 tabreceive~ \$0-amp-imag;
#X obj 381 695 tabsend~ \$0-amp-imag;
#X obj 255 718 tabsend~ \$0-amp-real;
#X text 361 6 previous output amplitude \, encoding both magnitude
and phase;
#X text 453 87 previous phase increment (unit-magnitude complex number)
;
#X obj 605 353 +~ 1e-15;
#X obj 367 50 +~ 1e-15;
#X text 408 640 propagate amplitudes by multiplying in the;
#X text 406 657 increments \, which advance the phase and drop;
#X text 410 672 magnitude according to revtime.;
#X text 607 525 normalize increments between 0 and;
#X text 606 539 1 according to revtime.;
#X text 78 453 IFFT and output;
#N canvas 167 161 699 396 detect_inc_rel_max_in_spec 0;
#X obj 49 101 inlet~;
#X obj 50 341 outlet~;
#X obj 50 183 -~;
#X obj 50 226 clip~ 0 1;
#X obj 50 204 *~ 1e+20;
#X obj 196 98 inlet~;
#X text 137 213 stronger than;
#X text 139 228 old one;
#X obj 274 202 -~;
#X obj 288 177 lrshift~ 1;
#X obj 274 250 clip~ 0 1;
#X obj 274 228 *~ 1e+20;
#X obj 450 202 -~;
#X obj 450 250 clip~ 0 1;
#X obj 450 228 *~ 1e+20;
#X obj 464 177 lrshift~ -1;
#X obj 50 283 *~;
#X obj 50 312 *~;
#X text 135 199 1 if new signal;
#X text 55 73 new;
#X text 203 70 old;
#X text 51 12 Choose whether to replace the "lod" signal with the "new"
one. The "new" one must be stronger than the old one and also must
be stronger than its two neighboring channels;
#X text 267 283 1 if we're louder than neighbor;
#X text 83 314 signal logic AND;
#X text 83 284 signal logic AND;
#X text 49 365 1 if increasing \, relative maximum in spectrum;
#X connect 0 0 2 0;
#X connect 0 0 9 0;
#X connect 0 0 8 0;
#X connect 0 0 12 0;
#X connect 0 0 15 0;
#X connect 2 0 4 0;
#X connect 3 0 16 0;
#X connect 4 0 3 0;
#X connect 5 0 2 1;
#X connect 8 0 11 0;
#X connect 9 0 8 1;
#X connect 10 0 16 1;
#X connect 11 0 10 0;
#X connect 12 0 14 0;
#X connect 13 0 17 1;
#X connect 14 0 13 0;
#X connect 15 0 12 1;
#X connect 16 0 17 0;
#X connect 17 0 1 0;
#X restore 23 172 pd detect_inc_rel_max_in_spec;
#X text 20 206 1 if increasing \, relative maximum in spectrum;
#N canvas 0 22 491 250 complex_mult~ 0;
#X obj 45 39 inlet~;
#X obj 60 161 outlet~;
#X obj 107 40 inlet~;
#X obj 107 100 *~;
#X obj 52 98 *~;
#X obj 213 45 inlet~;
#X obj 231 167 outlet~;
#X obj 275 46 inlet~;
#X obj 275 106 *~;
#X obj 220 104 *~;
#X obj 229 135 +~;
#X text 68 183 real;
#X text 243 185 imag;
#X obj 61 129 -~;
#X text 49 19 real1;
#X text 114 18 imag1;
#X text 217 25 real2;
#X text 282 24 imag2;
#X connect 0 0 4 0;
#X connect 0 0 8 1;
#X connect 2 0 3 0;
#X connect 2 0 9 1;
#X connect 3 0 13 1;
#X connect 4 0 13 0;
#X connect 5 0 9 0;
#X connect 5 0 4 1;
#X connect 7 0 8 0;
#X connect 7 0 3 1;
#X connect 8 0 10 1;
#X connect 9 0 10 0;
#X connect 10 0 6 0;
#X connect 13 0 1 0;
#X restore 255 612 pd complex_mult~;
#N canvas 0 22 596 350 complex_mult_by_conjug~ 0;
#X obj 45 39 inlet~;
#X obj 60 161 outlet~;
#X obj 107 40 inlet~;
#X obj 107 100 *~;
#X obj 52 98 *~;
#X obj 213 45 inlet~;
#X obj 231 167 outlet~;
#X obj 275 46 inlet~;
#X obj 275 106 *~;
#X obj 220 104 *~;
#X text 68 183 real;
#X text 243 185 imag;
#X text 49 19 real1;
#X text 114 18 imag1;
#X text 217 25 real2;
#X text 282 24 imag2;
#X obj 61 129 +~;
#X obj 229 135 -~;
#X obj 418 176 outlet~;
#X obj 491 175 outlet~;
#X connect 0 0 4 0;
#X connect 0 0 8 1;
#X connect 0 0 18 0;
#X connect 2 0 3 0;
#X connect 2 0 9 1;
#X connect 2 0 19 0;
#X connect 3 0 16 1;
#X connect 4 0 16 0;
#X connect 5 0 9 0;
#X connect 5 0 4 1;
#X connect 7 0 8 0;
#X connect 7 0 3 1;
#X connect 8 0 17 1;
#X connect 9 0 17 0;
#X connect 16 0 1 0;
#X connect 17 0 6 0;
#X restore 477 223 pd complex_mult_by_conjug~;
#X obj 612 169 tabreceive~ \$0-last-real;
#X obj 682 195 tabreceive~ \$0-last-imag;
#X text 695 221 divide-by-prev;
#X obj 1030 470 r \$0-revtime;
#X obj 960 215 / 2;
#X obj 959 239 t b f;
#X obj 959 266 f \$0;
#X obj 958 294 pack 0 0;
#X obj 317 477 r \$0-window-size;
#X msg 318 503 1 \$1;
#X obj 318 529 /;
#X text 111 547 normalize;
#X obj 18 547 *~ 0.00025;
#X obj 518 502 *~ 0.99;
#X obj 1086 232 s \$0-hann;
#X msg 1086 203 resize \$1;
#X obj 1050 286 tabwrite \$0-hann;
#N canvas 0 22 487 551 calc_hann 0;
#X obj 68 207 t f f;
#X obj 67 361 t f f;
#X obj 67 386 *;
#X obj 318 179 expr atan(1)*4;
#X obj 68 277 * 3.14;
#X obj 67 334 sin;
#X obj 68 156 until;
#X obj 109 43 inlet;
#X obj 108 77 t f f b;
#X obj 67 428 outlet;
#X obj 194 427 outlet;
#X obj 68 181 ../generics/counter 4096;
#X obj 68 305 / 4096;
#X connect 0 0 4 0;
#X connect 0 1 10 0;
#X connect 1 0 2 0;
#X connect 1 1 2 1;
#X connect 2 0 9 0;
#X connect 3 0 4 1;
#X connect 4 0 12 0;
#X connect 5 0 1 0;
#X connect 6 0 11 0;
#X connect 7 0 8 0;
#X connect 8 0 6 0;
#X connect 8 1 11 1;
#X connect 8 1 12 1;
#X connect 8 2 3 0;
#X connect 8 2 11 2;
#X connect 11 0 0 0;
#X connect 12 0 5 0;
#X restore 1051 257 pd calc_hann;
#X obj 987 89 r \$0-window-size;
#N canvas 0 22 337 242 power_spec~ 0;
#X obj 45 39 inlet~;
#X obj 63 161 outlet~;
#X obj 192 36 inlet~;
#X text 49 19 real;
#X text 199 14 imag;
#X obj 107 100 *~;
#X obj 52 98 *~;
#X obj 61 129 +~;
#X connect 0 0 6 0;
#X connect 0 0 6 1;
#X connect 2 0 5 0;
#X connect 2 0 5 1;
#X connect 5 0 7 1;
#X connect 6 0 7 0;
#X connect 7 0 1 0;
#X restore 22 144 pd power_spec~;
#N canvas 0 22 337 242 power_spec~ 0;
#X obj 45 39 inlet~;
#X obj 63 161 outlet~;
#X obj 192 36 inlet~;
#X text 49 19 real;
#X text 199 14 imag;
#X obj 107 100 *~;
#X obj 52 98 *~;
#X obj 61 129 +~;
#X connect 0 0 6 0;
#X connect 0 0 6 1;
#X connect 2 0 5 0;
#X connect 2 0 5 1;
#X connect 5 0 7 1;
#X connect 6 0 7 0;
#X connect 7 0 1 0;
#X restore 252 146 pd power_spec~;
#N canvas 650 183 602 327 switch_pairs_x1100 0;
#X obj 19 163 inlet~;
#X obj 107 99 inlet~;
#X obj 169 100 inlet~;
#X obj 273 97 inlet~;
#X obj 333 97 inlet~;
#X obj 367 185 -~;
#X obj 338 231 +~;
#X obj 372 229 *~;
#X obj 250 182 -~;
#X obj 220 228 +~;
#X obj 254 228 *~;
#X obj 219 278 outlet~;
#X obj 338 274 outlet~;
#X text 46 28 switch between two pairs of inputs. If first inlet is
one \, take the left-hand pair \, otherwise the right-hand one.;
#X text 15 140 switch;
#X text 92 76 pass this if one;
#X text 269 77 pass this if zero;
#X connect 0 0 10 1;
#X connect 0 0 7 1;
#X connect 1 0 8 0;
#X connect 2 0 5 0;
#X connect 3 0 9 0;
#X connect 3 0 8 1;
#X connect 4 0 6 0;
#X connect 4 0 5 1;
#X connect 5 0 7 0;
#X connect 6 0 12 0;
#X connect 7 0 6 1;
#X connect 8 0 10 0;
#X connect 9 0 11 0;
#X connect 10 0 9 1;
#X restore 483 416 pd switch_pairs_x1100;
#N canvas 650 182 571 446 switch_pairs_x1100 0;
#X obj 19 163 inlet~;
#X obj 130 109 inlet~;
#X obj 192 110 inlet~;
#X obj 367 106 inlet~;
#X obj 427 106 inlet~;
#X obj 367 185 -~;
#X obj 350 265 +~;
#X obj 374 245 *~;
#X obj 250 182 -~;
#X obj 232 266 +~;
#X obj 263 247 *~;
#X obj 233 291 outlet~;
#X obj 351 289 outlet~;
#X text 46 28 switch between two pairs of inputs. If first inlet is
one \, take the left-hand pair \, otherwise the right-hand one.;
#X text 15 140 switch;
#X text 115 86 pass this if one;
#X text 363 86 pass this if zero;
#X connect 0 0 10 1;
#X connect 0 0 7 1;
#X connect 1 0 8 0;
#X connect 2 0 5 0;
#X connect 3 0 9 0;
#X connect 3 0 8 1;
#X connect 4 0 6 0;
#X connect 4 0 5 1;
#X connect 5 0 7 0;
#X connect 6 0 12 0;
#X connect 7 0 6 1;
#X connect 8 0 10 0;
#X connect 9 0 11 0;
#X connect 10 0 9 1;
#X restore 92 336 pd switch_pairs_x1100;
#X msg 959 320 \; \$1-last-real resize \$2 \; \$1-last-imag resize
\$2 \; \$1-amp-real resize \$2 \; \$1-amp-imag resize \$2 \; \$1-inc-real
resize \$2 \; \$1-inc-imag resize \$2;
#X obj 963 444 expr 1 - 0.2/max(0.2 \, $f1);
#X obj 920 524 samplerate~;
#X obj 919 649 dbtorms;
#X obj 919 626 + 100;
#X obj 920 578 / 10;
#X obj 919 602 * 2048;
#X obj 1030 494 t b f;
#X obj 920 496 t b f;
#X obj 987 119 t f f f f f;
#X obj 920 550 expr -20 / $f1;
#X connect 0 0 17 0;
#X connect 0 0 40 3;
#X connect 1 0 9 0;
#X connect 2 0 9 0;
#X connect 3 0 7 0;
#X connect 5 0 54 0;
#X connect 6 0 3 0;
#X connect 7 0 64 1;
#X connect 7 0 61 0;
#X connect 7 0 41 0;
#X connect 7 1 64 2;
#X connect 7 1 61 1;
#X connect 7 1 41 1;
#X connect 8 0 5 0;
#X connect 9 0 55 0;
#X connect 10 0 18 0;
#X connect 10 0 40 2;
#X connect 11 0 5 1;
#X connect 12 0 3 1;
#X connect 13 0 30 0;
#X connect 14 0 63 4;
#X connect 19 0 20 0;
#X connect 24 0 31 0;
#X connect 25 0 64 4;
#X connect 25 0 62 1;
#X connect 30 0 63 3;
#X connect 31 0 64 3;
#X connect 31 0 62 0;
#X connect 38 0 64 0;
#X connect 38 0 63 0;
#X connect 40 0 27 0;
#X connect 40 1 26 0;
#X connect 41 0 63 1;
#X connect 41 1 63 2;
#X connect 41 2 16 0;
#X connect 41 3 15 0;
#X connect 42 0 41 2;
#X connect 43 0 41 3;
#X connect 45 0 72 0;
#X connect 46 0 47 0;
#X connect 47 0 48 0;
#X connect 47 1 49 1;
#X connect 48 0 49 0;
#X connect 49 0 65 0;
#X connect 50 0 51 0;
#X connect 51 0 52 0;
#X connect 52 0 54 1;
#X connect 54 0 4 0;
#X connect 55 0 10 1;
#X connect 55 0 0 0;
#X connect 57 0 56 0;
#X connect 59 0 58 0;
#X connect 59 1 58 1;
#X connect 60 0 74 0;
#X connect 61 0 38 0;
#X connect 62 0 38 1;
#X connect 63 0 2 0;
#X connect 63 0 2 1;
#X connect 63 0 10 0;
#X connect 63 1 1 0;
#X connect 63 1 1 1;
#X connect 63 1 0 1;
#X connect 64 0 8 0;
#X connect 64 0 40 0;
#X connect 64 1 8 1;
#X connect 64 1 40 1;
#X connect 67 0 75 0;
#X connect 68 0 55 1;
#X connect 69 0 68 0;
#X connect 70 0 71 0;
#X connect 71 0 69 0;
#X connect 72 0 67 0;
#X connect 72 1 70 1;
#X connect 73 0 67 0;
#X connect 73 1 71 1;
#X connect 74 0 19 0;
#X connect 74 1 46 0;
#X connect 74 2 59 0;
#X connect 74 3 57 0;
#X connect 74 4 73 0;
#X connect 75 0 70 0;
#X restore 79 284 pd fft-analysis-resynthesis;
#X obj 285 51 inlet;
#X text 279 33 fini-bang;
#X text 340 414 parameter-out;
#X text 78 392 signal-out;
#X text 70 22 signal-in;
#N canvas 0 22 550 314 docu_msp 0;
#X text 141 47 PIANO REVERB;
#X text 33 63 This is a phase vocoder acting as a reverberator. The
sound is more coherent (less "whispered") than a real room or a standard
delay-based reverberator.;
#X text 35 118 The technique is to "punch" the incoming sound into
channels where (1) there's a peak \, and (2) the incoming sound drowns
out whatever might already be there. If the sound already in any channel
is louder than the input the input for that channel is ignored.;
#X text 34 202 For each window \, the amplitude in each channel is
propagated by a constant phase increment and multiplied downward by
a gain that determines the "reverb time".;
#X restore 414 233 pd docu_msp;
#X text 341 400 rejected para;
#X obj 256 206 s \$0-window-size;
#X obj 146 205 s \$0-revtime;
#X obj 147 139 route reverbTime FFTSize;
#X text 93 467 based on Miller Puckette's pvoc.reverb;
#X obj 488 372 outlet;
#X text 405 32 incoming parameter;
#X text 475 398 outgoing parameter;
#X connect 3 0 9 0;
#X connect 4 0 19 0;
#X connect 9 0 7 0;
#X connect 19 0 18 0;
#X connect 19 1 17 0;
#X connect 19 2 8 0;
